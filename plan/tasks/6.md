# Task 6 — Session Brain hooks (SessionStart inject, PreCompact/SessionEnd persist)

## Goal

Make Session Brain “just work” via plugin hooks, following `docs/voyager.md`.

## Deliverables

- `hooks/hooks.json` wiring:
  - `SessionStart` → `scripts/brain/inject_context.py`
  - `PreCompact` → `scripts/brain/update_brain.py`
  - `SessionEnd` → `scripts/brain/update_brain.py`
- Standalone dogfood wiring (project-local, optional but recommended):
  - wrapper hook scripts under `./.claude/hooks/` that delegate to the repo’s `scripts/brain/*.py`
  - a small setup helper (script or CLI) that installs/updates these wrappers without overwriting unrelated hooks
- `scripts/brain/inject_context.py`
  - reads `.claude/voyager/brain.md` (if any)
  - generates a fresh repo snapshot
  - outputs valid hook JSON:
    - `hookSpecificOutput.additionalContext` contains:
      - “Session Brain (compressed)”
      - “Repo Snapshot (compressed)”
      - optionally “Top next actions” if available
    - `suppressOutput: true`

## Acceptance criteria

- Hook scripts accept stdin JSON and do not crash on missing fields.
- SessionStart injection is fast and does not invoke the LLM by default.
- PreCompact/SessionEnd persist brain updates and create episode entries.
- Dogfood: add fixture inputs under `.claude/fixtures/hooks/` and verify locally:
  - `session_start.json` piped to `scripts/brain/inject_context.py` yields valid hook JSON with `additionalContext`.
  - `precompact.json` and `session_end.json` piped to `scripts/brain/update_brain.py` update `./.claude/voyager/` artifacts in this repo.
  - optional: enabling the project-local wrappers under `./.claude/hooks/` produces the same behavior in a real session.
