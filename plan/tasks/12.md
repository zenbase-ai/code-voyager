# Task 12 — Skill Retrieval System (ColBERT index + `find-skill`)

## Goal

Implement the retrieval pipeline from `docs/retrieval.md`: auto-discover skill libraries, use LLM to extract metadata, generate embedding text, build/search a ColBERT index via [PyLate](https://context7.com/lightonai/pylate/llms.txt?tokens=10000).

## Deliverables

- Python modules (library-first; CLIs are thin):
  - `src/voyager/retrieval/discovery.py` (auto-discover skills root + SKILL.md folders)
  - `src/voyager/retrieval/analyzer.py` (LLM metadata extractor)
  - `src/voyager/retrieval/embedding.py` (embedding text generator)
  - `src/voyager/retrieval/index.py` (build/search; persists under `~/.skill-index/` by default)
- CLIs:
  - `skill-index` (build/rebuild; supports `--skills-root`, `--force`, `--llm-command`)
  - `find-skill "<query>"` (search; supports `-k`, `--json`)
- Optional Claude skill wrapper:
  - `skills/skill-retrieval/SKILL.md` describing when/how to use `find-skill`
- Dogfooding support:
  - discovery includes (or can be explicitly pointed at) both:
    - plugin skills: `./skills/**/SKILL.md`
    - local mirror skills: `./.claude/skills/local/**/SKILL.md`
    - generated skills: `./.claude/skills/generated/**/SKILL.md`
  - support a local index path for dogfooding (e.g., `--index-path ./.claude/voyager/skill-index/`) to avoid polluting user-global state
  - search can degrade gracefully if ColBERT deps/models aren’t available yet (e.g., “index missing” guidance, or an explicit lightweight fallback mode for local smoke tests)

## Acceptance criteria

- Works with “zero config” auto-discovery (env var override allowed).
- Index build persists across projects and search is fast (< ~1s typical).
- Gracefully degrades when dependencies or network/model downloads are unavailable:
  - clear error message for build
  - search returns “index missing” guidance rather than crashing.
- Dogfood: you can index this repo’s skills and successfully retrieve at least:
  - “resume where we left off” → Session Brain
  - “what should I work on next” → Repo Curriculum Planner
  - “turn this workflow into a skill” → Skill Factory
- Dogfood: use `find-skill` during development in this repo to locate the right skill docs (plugin `skills/` + local mirror + generated skills).
