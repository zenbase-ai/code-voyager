# Task 5 — Session Brain store (schema + renderer + updater)

## Goal

Implement the “Brain Store” under `.claude/voyager/` and the core brain update flow.

## Deliverables

- Skill folder: `skills/session-brain/`
  - `schemas/brain.schema.json` (v1 per `docs/voyager.md`)
  - `prompts/update_brain.prompt.md` (LLM prompt template; keep logic here, not in Python)
  - `reference.md` (how to interpret/update/reset brain)
- Library + scripts:
  - `src/voyager/brain/store.py` (paths + load/save)
  - `src/voyager/brain/render.py` (deterministic JSON → Markdown “brain.md”)
- `scripts/brain/update_brain.py`
    - inputs: `transcript_path`, `session_id`, `snapshot.json` (optional)
    - updates `.claude/voyager/brain.json` (validate against schema)
    - renders `.claude/voyager/brain.md`
    - writes `.claude/voyager/episodes/<timestamp>_<session_id>.json` (canonical) and optionally a human-readable `.md`
    - writes/updates `.claude/voyager/brain.last_update.json` (small, machine-friendly “last update” record for debugging)

## Acceptance criteria

- Brain JSON validates against `brain.schema.json`.
- Renderer output is concise and stable (no reflow noise that breaks diffs).
- If transcript is missing/unreadable, updater still writes a minimal brain update note and never crashes hooks.
- Dogfood: include a sample transcript at `.claude/fixtures/transcripts/session_0001.jsonl` and verify this repo can generate `./.claude/voyager/brain.json` + `./.claude/voyager/brain.md` from it.
