{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "brain.schema.json",
  "title": "Session Brain",
  "description": "Persistent working memory schema for Voyager coding sessions (v1)",
  "type": "object",
  "required": ["version", "project", "working_set", "decisions", "progress", "signals"],
  "properties": {
    "version": {
      "type": "integer",
      "const": 1,
      "description": "Schema version for future migrations"
    },
    "project": {
      "type": "object",
      "description": "High-level project understanding (inferred, stable)",
      "required": ["summary"],
      "properties": {
        "summary": {
          "type": "string",
          "description": "Brief description of what this project is/does"
        },
        "stack_guesses": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Inferred tech stack (e.g., 'Python 3.13', 'FastAPI', 'PostgreSQL')"
        },
        "key_commands": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Common dev commands (e.g., 'pytest', 'npm run dev')"
        }
      }
    },
    "working_set": {
      "type": "object",
      "description": "Current session context (volatile, updates often)",
      "required": [],
      "properties": {
        "current_goal": {
          "type": "string",
          "description": "What we're trying to accomplish right now"
        },
        "current_plan": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Steps toward the current goal"
        },
        "open_questions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Unresolved questions that need answers"
        },
        "risks": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Known risks or blockers"
        }
      }
    },
    "decisions": {
      "type": "array",
      "description": "Architectural/design decisions made during sessions",
      "items": {
        "type": "object",
        "required": ["when", "decision"],
        "properties": {
          "when": {
            "type": "string",
            "description": "ISO timestamp or session reference"
          },
          "decision": {
            "type": "string",
            "description": "What was decided"
          },
          "rationale": {
            "type": "string",
            "description": "Why this decision was made"
          },
          "implications": {
            "type": "array",
            "items": { "type": "string" },
            "description": "What this decision affects"
          }
        }
      }
    },
    "progress": {
      "type": "object",
      "description": "Work progress tracking",
      "required": [],
      "properties": {
        "recent_changes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Recent modifications (last 1-2 sessions)"
        },
        "done": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Completed milestones/tasks"
        }
      }
    },
    "signals": {
      "type": "object",
      "description": "Metadata for state management",
      "required": [],
      "properties": {
        "last_session_id": {
          "type": "string",
          "description": "ID of the last session that updated the brain"
        },
        "last_updated_at": {
          "type": "string",
          "description": "ISO timestamp of last update"
        }
      }
    }
  }
}
